<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content="Upgrade Ruby on Rails - (rudolph-miller)" />
  
  <meta property="og:site_name" content="(rudolph-miller)" />
  <meta property="og:url" content="http://blog.rudolph-miller.com/slide/2015/10/16/upgrade_ruby_on_rails/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:published_time" content="2015-10-16T12:01:40&#43;09:00" />
  
  <meta property="og:article:tag" content="Ruby on Rails" />
  
  

  <title>
    Upgrade Ruby on Rails - (rudolph-miller)
  </title>

  <link rel="stylesheet" href="http://blog.rudolph-miller.com/css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://blog.rudolph-miller.com/css/main.css" />
  <link rel="stylesheet" href="http://blog.rudolph-miller.com/css/font-awesome.min.css" />
  <link rel="stylesheet" href="http://blog.rudolph-miller.com/css/github.css" />
  <link rel="stylesheet" href="http://blog.rudolph-miller.com/highlight-lisp/themes/github.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" type="text/css">
  <link rel="shortcut icon" href="http://blog.rudolph-miller.com/images/favicon.png" />
  <link rel="icon" href="http://blog.rudolph-miller.com/images/favicon.png" />
  <link rel="apple-touch-icon" href="http://blog.rudolph-miller.com/images/apple-touch-icon.png" />
  
  
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,200,300|Ubuntu+Mono:400,700,400italic|Yanone+Kaffeesatz|Droid+Serif:400,700,400italic' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="http://blog.rudolph-miller.com/css/remark.css" />
  
</head>



<body>
  <script src="http://blog.rudolph-miller.com/js/remark-latest.min.js"></script>
  <textarea id="source" style="display: none;">
name: inverse
layout: true
class: center, middle, inverse
---

# Kaizen Week #1

---

# @Rudolph-Miller

---

# 3.2 to 4.2

---

# Upgrade Ruby on Rails

---

layout: false
.left-column[
手順
===
]

.right-column[
1. リリースノート.
  - リリースノートで変更を頭に入れておく.
2. Gemのupgrade.
  - RailsのUpgrade.
  - 依存解決.
3. 作業.
  - 壊れたところを直す.
4. 2 -&gt; 3を繰り返す.
  - RailsのVersionは徐々にあげる.
  - 3.2 -&gt; 4.0 -&gt; 4.1 -&gt; 4.2
]

---

## リリースノートはNew Railsの説明書

- [Ruby on Rails 4.0 リリースノート](http://railsguides.jp/4_0_release_notes.html)
- [Ruby on Rails 4.1 リリースノート](http://railsguides.jp/4_1_release_notes.html)
- [Ruby on Rails 4.2 リリースノート](http://railsguides.jp/4_2_release_notes.html)

---

template: inverse

# 説明書は読まないタイプ.

---

.left-column[
# 作業
]

.right-column[
1. Railsのupdate.
2. `bundle upgate rails`
  - 依存解決に失敗したら頑張る.
  - `bundle update`
3. `bundle exec rake rails:update`
  - config fileのupdate.
4. `bundle exec rake spec`
  - 起動するまで頑張る.
  - 起動してからも頑張る.
]

---
template: inverse

# 障害

---


.left-column[
## API変更
]

.right-column[
- scopeの書き方.
  - 心を無にして対応.
- relationの定義のincludeがdeprecated.
  - 心を無にして(ry.
- joinsしてそのtableの条件を使用する時はreferencesを明示する.
  - 心を(ry.
]

---

.left-column[
## Gem
]

.right-column[
- メンテ停止したGem達.
- 別Versionでの動作が保証されていないpatchが多数.
]

---

.left-column[
## ActiveRecord
]

.right-column[
### 失われた`bind_values`

- ActiveRecordをUpgrade.
  - 4.0 -&gt; 4.1
  - 4.1 -&gt; 4.2
- existsがbroken.
  - とはいえ相関subqueryのPerformanceは.
  - `INNER JOIN`で書き直すか.
- subqueryがbroken.
]

---
template: inverse

# 結果

---

background-image: url(/images/20151016/to_be_continued.jpg)

  </textarea>
  <script>
    var slideshow = remark.create({
      navigation: {
        scroll: true,
        touch: true,
        click: false
      }
    });
    if (!window.TouchEvent){
    var slideArea = document.getElementsByClassName('remark-slides-area')[0]
      var threshold = window.innerWidth / 2;
      slideArea.onclick = function(event) {
        if (event.target.nodeName === 'A') {
          return;
        }
        else if (event.button === 0) {
          if ((event.x - threshold) > 0) {
            slideshow.gotoNextSlide();
          } else {
            slideshow.gotoPreviousSlide();
          }
        };
      }
    }
    </script>
  </body>
</html>
